.. |labmodule| replace:: 1
.. |labnum| replace:: 0
.. |labdot| replace:: |labmodule|\ .\ |labnum|
.. |labund| replace:: |labmodule|\ _\ |labnum|
.. |labname| replace:: Lab\ |labdot|
.. |labnameund| replace:: Lab\ |labund|

Module |labmodule|\, Lab \ |labnum|\: API Authentication
=========================================================

Overview
--------

In this lab, the iControl REST API will be used to provision a module on the BIG-IP.  Before we begin, lets review how to generate an Authentication Token.

.. NOTE::
    - Use Postman collection to complete this lab.
    - Some response content has been removed for brevity.

|labmodule|\.\ |labnum|\.1. Get an Authentication Token
----------------------------------------------------------------

The **Authentication Token** is generated by using an HTTP POST with a body containing the username, password, and login provider to the REST endpoint for ``/mgmt/shared/authn/login``.

.. Hint::  
  1) Select the "F5 SecDevOps" Environment in Postman.
  2) Send a **Request** with the following details.
     
     | **Method**
     
     ::
     
         POST

     | **URL**
     
     ::
     
         https://{{big_ip_a_mgmt}}/mgmt/shared/authn/login
     
     | **Headers**
     
     ::
     
      Content-Type: application/json
     
     | **Body**
	 
     ::
     
         {
             "username":"admin"
             "password":"admin"
             "loginProviderName":"tmos"
         }

  3) Copy the **token** you received into the **big_ip_a_auth_token** Postman environment variable.


**Example Response**

.. code-block:: rest
    :emphasize-lines: 8 

	{
		"username": "admin",
		"loginReference": {
			"link": "https://localhost/mgmt/cm/system/authn/providers/tmos/1f44a60e-11a7-3c51-a49f-82983026b41b/login"
		},
		"loginProviderName": "tmos",
		"token": {
			"token": "TCJMWPGBQGPZPJYUCY57J2IITA",
			"name": "TCJMWPGBQGPZPJYUCY57J2IITA",
			"userName": "admin",
			"authProviderName": "tmos",
			"user": {
				"link": "https://localhost/mgmt/shared/authz/users/admin"
			},
			"timeout": 1200,
			"startTime": "2018-08-01T08:05:37.679-0700",
			"address": "10.1.1.250",
			"partition": "[All]",
			"generation": 1,
			"lastUpdateMicros": 1533135937678293,
			"expirationMicros": 1533137137679000,
			"kind": "shared:authz:tokens:authtokenitemstate",
			"selfLink": "https://localhost/mgmt/shared/authz/tokens/TCJMWPGBQGPZPJYUCY57J2IITA"
		},
		"generation": 0,
		"lastUpdateMicros": 0
	}

|labmodule|\.\ |labnum|\.2. Verify the Authentication Token Works
--------------------------------------------------------------------

.. Hint::  
  1) Send a **Request** with the following details.
     
     | **Method**
     
     ::
     
         GET

     | **URL**
     
     ::
     
         https://{{big_ip_a_mgmt}}/mgmt/tm/ltm
     
     | **Headers**
     
     ::
     
      X-F5-Auth-Token: {{big_ip_a_auth_token}}
     
     | **Body**


**Example Response**

.. code-block:: rest

	{
		"kind": "tm:ltm:ltmcollectionstate",
		"selfLink": "https://localhost/mgmt/tm/ltm?ver=13.1.0.8",
		"items": [
			{
				"reference": {
					"link": "https://localhost/mgmt/tm/ltm/auth?ver=13.1.0.8"
				}
			},
			{
				"reference": {
					"link": "https://localhost/mgmt/tm/ltm/cipher?ver=13.1.0.8"
				}
			},
			{
				"reference": {
					"link": "https://localhost/mgmt/tm/ltm/data-group?ver=13.1.0.8"
				}
			},

|labmodule|\.\ |labnum|\.3. Set the Authentication Token Timeout
-------------------------------------------------------------------

The **Authentication Token** timeout is set using an HTTP PATCH with a body containing the desired value to the REST endpoint for ``mgmt/shared/authz/tokens/{{big_ip_a_auth_token}}``.

.. Hint::  
  1) Send a **Request** with the following details.
     
     | **Method**
     
     ::
     
         PATCH

     | **URL**
     
     ::
     
         https://{{big_ip_a_mgmt}}/mgmt/shared/authz/tokens/{{big_ip_a_auth_token}}
     
     | **Headers**
     
     ::
     
          Content-Type: application/json
	  X-F5-Auth-Token: {{big_ip_a_auth_token}}
     
     | **Body**
	 
     ::
     
         {
             "timeout":"36000"
         }


**Example Response**

.. code-block:: rest
    :emphasize-lines: 9

	{
		"token": "X54G4KAQUEGFZX2J7MUMFBKBC5",
		"name": "X54G4KAQUEGFZX2J7MUMFBKBC5",
		"userName": "admin",
		"authProviderName": "tmos",
		"user": {
			"link": "https://localhost/mgmt/shared/authz/users/admin"
		},
		"timeout": 36000,
		"startTime": "2018-08-01T08:27:58.961-0700",
		"address": "10.1.1.250",
		"partition": "[All]",
		"generation": 2,
		"lastUpdateMicros": 1533137298286141,
		"expirationMicros": 1533173278961000,
		"kind": "shared:authz:tokens:authtokenitemstate",
		"selfLink": "https://localhost/mgmt/shared/authz/tokens/X54G4KAQUEGFZX2J7MUMFBKBC5"
	}

